(function(d,o){typeof exports=="object"&&typeof module!="undefined"?o(exports):typeof define=="function"&&define.amd?define(["exports"],o):(d=typeof globalThis!="undefined"?globalThis:d||self,o(d.VuePrintNext={}))})(this,function(d){"use strict";var E=Object.defineProperty,A=Object.defineProperties;var k=Object.getOwnPropertyDescriptors;var w=Object.getOwnPropertySymbols;var I=Object.prototype.hasOwnProperty,S=Object.prototype.propertyIsEnumerable;var m=(d,o,p)=>o in d?E(d,o,{enumerable:!0,configurable:!0,writable:!0,value:p}):d[o]=p,b=(d,o)=>{for(var p in o||(o={}))I.call(o,p)&&m(d,p,o[p]);if(w)for(var p of w(o))S.call(o,p)&&m(d,p,o[p]);return d},x=(d,o)=>A(d,k(o));var g=(d,o,p)=>m(d,typeof o!="symbol"?o+"":o,p);class o{constructor(e){g(this,"standards",{strict:"strict",loose:"loose",html5:"html5"});g(this,"iframeId","");g(this,"previewBody",null);g(this,"close",null);g(this,"previewBodyUtilPrintBtn",null);g(this,"counter",0);g(this,"printContentDom",null);g(this,"settings",{standard:"html5",zIndex:20002,previewTitle:"打印预览",previewPrintBtnLabel:"打印",preview:!1});const t=e.vue;this.settings=Object.assign({},this.settings,e,{previewBeforeOpenCallback(){var i;(i=e.previewBeforeOpenCallback)==null||i.call(e,t)},previewOpenCallback(){var i;(i=e.previewOpenCallback)==null||i.call(e,t)},openCallback(){var i;(i=e.openCallback)==null||i.call(e,t)},closeCallback(){var i;(i=e.closeCallback)==null||i.call(e,t)},beforeOpenCallback(){var i;(i=e.beforeOpenCallback)==null||i.call(e,t)}}),this.init()}init(){this.counter++,this.iframeId=`printArea_${this.counter}`;let e="";if(this.settings.url&&!this.settings.asyncUrl&&(e=this.settings.url),this.settings.asyncUrl){this.settings.asyncUrl(i=>{let r=this.getPrintWindow(i);this.settings.preview?this.previewIframeLoad():this.print(r)},this.settings.vue);return}const t=this.getPrintWindow(e);this.settings.url||this.write(t.doc),this.settings.preview?this.previewIframeLoad():this.print(t)}addEvent(e,t,i){e&&(e.addEventListener?e.addEventListener(t,i,!1):e.attachEvent?e.attachEvent("on"+t,i):e["on"+t]=i)}previewIframeLoad(){var t,i;let e=document.getElementById("vue-pirnt-next-previewBox");if(e){let r=e.querySelector("iframe");(i=(t=this.settings).previewBeforeOpenCallback)==null||i.call(t),this.addEvent(r,"load",()=>{var l,s;this.previewBoxShow(),this.removeCanvasImg(),(s=(l=this.settings).previewOpenCallback)==null||s.call(l)}),this.addEvent(e.querySelector(".previewBodyUtilPrintBtn"),"click",()=>{var l,s,n,a,c,h,v;(s=(l=this.settings).beforeOpenCallback)==null||s.call(l),(a=(n=this.settings).openCallback)==null||a.call(n),(c=r==null?void 0:r.contentWindow)==null||c.print(),(v=(h=this.settings).closeCallback)==null||v.call(h)})}}removeCanvasImg(){try{if(this.printContentDom){let e=this.printContentDom.querySelectorAll(".canvasImg");for(let t=0;t<e.length;t++)e[t].remove()}}catch(e){console.log(e)}}print(e){var l,s;let t=document.getElementById(this.iframeId)||e.f,i=t==null?void 0:t.contentWindow;if(!i)return;const r=()=>{var n,a,c,h;i.focus(),(a=(n=this.settings).openCallback)==null||a.call(n),i.print(),t.remove(),(h=(c=this.settings).closeCallback)==null||h.call(c),this.removeCanvasImg()};(s=(l=this.settings).beforeOpenCallback)==null||s.call(l),this.addEvent(t,"load",()=>r())}write(e){e.open(),e.write(`${this.docType()}<html lang="zh">${this.getHead()}${this.getBody()}</html>`),e.close()}docType(){if(this.settings.standard===this.standards.html5)return"<!DOCTYPE html>";const e=this.settings.standard===this.standards.loose?" Transitional":"",t=this.settings.standard===this.standards.loose?"loose":"strict";return`<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01${e}//EN" "http://www.w3.org/TR/html4/${t}.dtd">`}getHead(){var l;let e="",t="",i="";this.settings.extraHead&&(e=this.settings.extraHead.split(",").map(s=>s.trim()).filter(s=>s.length>0).join("")),t=Array.from(document.querySelectorAll("link")).filter(s=>s.href.includes(".css")).map(s=>`<link type="text/css" rel="stylesheet" href="${s.href}">`).join("");let r=document.styleSheets;if(r&&r.length>0)for(let s=0;s<r.length;s++)try{if(r[s].cssRules||r[s].rules){let n=r[s].cssRules||r[s].rules;for(let a=0;a<n.length;a++)i+=n[a].cssText}}catch(n){console.log((((l=r[s])==null?void 0:l.href)||"")+n)}return this.settings.extraCss&&(t+=this.settings.extraCss.split(",").filter(s=>s.trim().length>0).map(s=>`<link type="text/css" rel="stylesheet" href="${s.trim()}">`).join("")),`<head><title>${this.settings.popTitle}</title>${e}${t}<style>${i}</style></head>`}getBody(){const t=this.settings.id.replace(new RegExp("#","g"),""),i=document.getElementById(t);if(!i)throw new Error("dom is not found！");return this.printContentDom=this.beforeHandler(i),"<body>"+this.getFormData(this.printContentDom).outerHTML+"</body>"}beforeHandler(e){let t=e.querySelectorAll("canvas");for(let i=0;i<t.length;i++)if(!t[i].style.display){let r=t[i].parentNode,l=t[i].toDataURL("image/png"),s=new Image;s.className="canvasImg",s.style.display="none",s.src=l,r==null||r.appendChild(s)}return e}getFormData(e){let t=e.cloneNode(!0),i=t.querySelectorAll("input,select,textarea"),r=t.querySelectorAll(".canvasImg,canvas"),l=-1;for(let s=0;s<r.length;s++){let n=r[s].parentNode,a=r[s];a.tagName.toLowerCase()==="canvas"?n==null||n.removeChild(a):a.style.display="block"}for(let s=0;s<i.length;s++){const n=i[s],a=n.value,c=i[s];let h=n.getAttribute("type");if(h||(h=n.tagName==="SELECT"?"select":n.tagName==="TEXTAREA"?"textarea":""),n.tagName==="INPUT")h==="radio"||h==="checkbox"?n.checked&&c.setAttribute("checked",String(n.checked)):(c.value=a,c.setAttribute("value",a));else if(h==="select"){l++;for(let v=0;v<e.querySelectorAll("select").length;v++){let f=e.querySelectorAll("select")[v];if(!f.getAttribute("newbs")&&f.setAttribute("newbs",v.toString()),f.getAttribute("newbs")===l.toString()){let C=e.querySelectorAll("select")[l].selectedIndex;n.options[C].setAttribute("selected","true")}}}else c.innerHTML=a,c.setAttribute("html",a)}return t}getPrintWindow(e){var r;const t=this.Iframe(e),i=t.contentDocument||((r=t.contentWindow)==null?void 0:r.document)||t.document;if(!i)throw new Error("Cannot find document.");return{f:t,win:t.contentWindow||t,doc:i}}previewBoxShow(){var t;let e=document.getElementById("vue-pirnt-next-previewBox");e&&((t=document.querySelector("html"))==null||t.setAttribute("style","overflow: hidden"),e.style.display="block")}previewBoxHide(){var t,i;let e=document.getElementById("vue-pirnt-next-previewBox");e&&((t=document.querySelector("html"))==null||t.setAttribute("style","overflow: visible;"),(i=e.querySelector("iframe"))==null||i.remove(),e.style.display="none")}previewBox(){var v,f;let e=document.getElementById("vue-pirnt-next-previewBox"),t="previewBody";if(e)return(v=e.querySelector("iframe"))==null||v.remove(),{close:e.querySelector(".previewClose"),previewBody:e.querySelector(`.${t}`)};let i=document.createElement("div");i.setAttribute("id","vue-pirnt-next-previewBox"),i.setAttribute("style","position: fixed;top: 0px;left: 0px;width: 100%;height: 100%;background: white;display:none"),i.style.zIndex=((f=this.settings.zIndex)==null?void 0:f.toString())||"1";let r=document.createElement("div");r.setAttribute("class","previewHeader"),r.setAttribute("style","padding: 5px 20px;"),r.innerHTML=this.settings.previewTitle||"",i.appendChild(r),this.close=document.createElement("div");let l=this.close;l.setAttribute("class","previewClose"),l.setAttribute("style","position: absolute;top: 5px;right: 20px;width: 25px;height: 20px;cursor: pointer;");let s=document.createElement("div"),n=document.createElement("div");s.setAttribute("class","closeBefore"),s.setAttribute("style","position: absolute;width: 3px;height: 100%;background: #040404;transform: rotate(45deg); top: 0px;left: 50%;"),n.setAttribute("class","closeAfter"),n.setAttribute("style","position: absolute;width: 3px;height: 100%;background: #040404;transform: rotate(-45deg); top: 0px;left: 50%;"),l.appendChild(s),l.appendChild(n),r.appendChild(l),this.previewBody=document.createElement("div");let a=this.previewBody;a.setAttribute("class",t),a.setAttribute("style","display: flex;flex-direction: column; height: 100%;"),i.appendChild(a);let c=document.createElement("div");c.setAttribute("class","previewBodyUtil"),c.setAttribute("style","height: 32px;background: #474747;position: relative;"),a.appendChild(c),this.previewBodyUtilPrintBtn=document.createElement("div");let h=this.previewBodyUtilPrintBtn;return h.setAttribute("class","previewBodyUtilPrintBtn"),h.innerHTML=this.settings.previewPrintBtnLabel||"",h.setAttribute("style","position: absolute;padding: 2px 10px;margin-top: 3px;left: 24px;font-size: 14px;color: white;cursor: pointer;background-color: rgba(0,0,0,.12);background-image: linear-gradient(hsla(0,0%,100%,.05),hsla(0,0%,100%,0));background-clip: padding-box;border: 1px solid rgba(0,0,0,.35);border-color: rgba(0,0,0,.32) rgba(0,0,0,.38) rgba(0,0,0,.42);box-shadow: inset 0 1px 0 hsla(0,0%,100%,.05), inset 0 0 1px hsla(0,0%,100%,.15), 0 1px 0 hsla(0,0%,100%,.05);"),c.appendChild(h),document.body.appendChild(i),{close:this.close,previewBody:this.previewBody}}iframeBox(e,t){let i=document.createElement("iframe");return i.style.border="0px",i.style.position="absolute",i.style.width="0px",i.style.height="0px",i.style.right="0px",i.style.top="0px",i.setAttribute("id",e),i.setAttribute("src",t),i}Iframe(e){e=e||new Date().getTime().toString();let t=this.iframeBox(this.iframeId,e);try{if(!this.settings.preview)document.body.appendChild(t);else{t.setAttribute("style","border: 0px;flex: 1;");let i=this.previewBox(),r=i.previewBody,l=i.close;r==null||r.appendChild(t),this.addEvent(l,"click",()=>{this.previewBoxHide()})}}catch(i){throw new Error(i+". iframes may not be supported in this browser.")}return t}}const p=(u,e,t)=>{u.addEventListener?u.addEventListener(e,t,!1):u.attacattachEventhEvent?u.attachEvent("on"+e,t):u["on"+e]=t},y={directiveName:"print",mounted(u,e){let t="",i={};p(u,"click",()=>{if(typeof e.value=="string")t=e.value;else if(typeof e.value=="object"&&e.value.id){t=e.value.id,i=e.value;let r=t.replace(new RegExp("#","g"),"");document.getElementById(r)||console.log("id in Error")}else{window.print();return}new o(x(b({},i),{id:t,vue:e.instance}))})}},B={install(u){u.directive("print",y)}};d.VuePrintNext=o,d.printPlugin=B,d.vPrint=y,Object.defineProperty(d,Symbol.toStringTag,{value:"Module"})});
