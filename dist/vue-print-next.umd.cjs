(function(l,o){typeof exports=="object"&&typeof module!="undefined"?o(exports):typeof define=="function"&&define.amd?define(["exports"],o):(l=typeof globalThis!="undefined"?globalThis:l||self,o(l.VuePrintNext={}))})(this,function(l){"use strict";var B=Object.defineProperty,C=Object.defineProperties;var A=Object.getOwnPropertyDescriptors;var x=Object.getOwnPropertySymbols;var E=Object.prototype.hasOwnProperty,k=Object.prototype.propertyIsEnumerable;var w=(l,o,c)=>o in l?B(l,o,{enumerable:!0,configurable:!0,writable:!0,value:c}):l[o]=c,y=(l,o)=>{for(var c in o||(o={}))E.call(o,c)&&w(l,c,o[c]);if(x)for(var c of x(o))k.call(o,c)&&w(l,c,o[c]);return l},m=(l,o)=>C(l,A(o));var v=(l,o,c)=>w(l,typeof o!="symbol"?o+"":o,c);class o{constructor(e){v(this,"standards",{strict:"strict",loose:"loose",html5:"html5"});v(this,"iframeId","");v(this,"previewBody",null);v(this,"close",null);v(this,"previewBodyUtilPrintBtn",null);v(this,"counter",0);v(this,"settings",{standard:"html5",zIndex:20002,previewTitle:"打印预览",previewPrintBtnLabel:"打印",preview:!1});const t=e.vue;this.settings=m(y(y({},this.settings),e),{previewBeforeOpenCallback(){var s;(s=e.previewBeforeOpenCallback)==null||s.call(e,t)},previewOpenCallback(){var s;(s=e.previewOpenCallback)==null||s.call(e,t)},openCallback(){var s;(s=e.openCallback)==null||s.call(e,t)},closeCallback(){var s;(s=e.closeCallback)==null||s.call(e,t)},beforeOpenCallback(){var s;(s=e.beforeOpenCallback)==null||s.call(e,t)}}),this.init()}init(){if(this.counter++,this.iframeId=`printArea_${this.counter}`,this.settings.asyncUrl)this.settings.asyncUrl(e=>{const t=this.getPrintWindow(e);this.settings.preview?this.previewIframeLoad():this.print(t)},this.settings.vue);else{const e=this.getPrintWindow(this.settings.url||"");this.settings.url||this.write(e.doc),this.settings.preview?this.previewIframeLoad():this.print(e)}}addEvent(e,t,s){e&&(e.addEventListener?e.addEventListener(t,s,!1):e.attachEvent?e.attachEvent("on"+t,s):e["on"+t]=s)}previewIframeLoad(){var s,n;const e=document.getElementById("vue-pirnt-next-previewBox");if(!e)return;const t=e.querySelector("iframe");(n=(s=this.settings).previewBeforeOpenCallback)==null||n.call(s),this.addEvent(t,"load",()=>{var i,r;this.previewBoxShow(),(r=(i=this.settings).previewOpenCallback)==null||r.call(i)}),this.addEvent(e.querySelector(".previewBodyUtilPrintBtn"),"click",()=>{var i,r,d,a,u,p,g;(r=(i=this.settings).beforeOpenCallback)==null||r.call(i),(a=(d=this.settings).openCallback)==null||a.call(d),(u=t==null?void 0:t.contentWindow)==null||u.print(),(g=(p=this.settings).closeCallback)==null||g.call(p)})}print(e){var i,r;const t=document.getElementById(this.iframeId)||e.f,s=t==null?void 0:t.contentWindow;if(!s)return;const n=()=>{var d,a,u,p;s.focus(),(a=(d=this.settings).openCallback)==null||a.call(d),s.print(),t.remove(),(p=(u=this.settings).closeCallback)==null||p.call(u)};(r=(i=this.settings).beforeOpenCallback)==null||r.call(i),this.addEvent(t,"load",n)}getNoPrintMediaStyle(){const e=this.settings.noPrintSelector;if(!e)return;if(!Array.isArray(e)&&!(typeof e=="string")){console.error("noPrintSelector 必须是数组或者字符串");return}return`${(Array.isArray(e)?e:[e]).filter(r=>r.trim()).join(",")} { display: none; }`}write(e){e.open(),e.write(`${this.docType()}<html lang='zh'>${this.getHead()}${this.getBody()}</html>`),e.close()}docType(){if(this.settings.standard===this.standards.html5)return"<!DOCTYPE html>";const e=this.settings.standard===this.standards.loose?" Transitional":"",t=this.settings.standard===this.standards.loose?"loose":"strict";return`<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01${e}//EN" "http://www.w3.org/TR/html4/${t}.dtd">`}getHead(){const e=(this.settings.extraHead||"").split(",").filter(r=>r.length>0).join(""),t=Array.from(document.querySelectorAll("link")).filter(r=>r.href.includes(".css")).map(r=>`<link type="text/css" rel="stylesheet" href='${r.href}'>`).join(""),s=Array.from(document.styleSheets).reduce((r,d)=>{try{if(d.cssRules||d.rules){const a=d.cssRules||d.rules;r+=Array.from(a).reduce((u,p)=>u+p.cssText,"")}}catch(a){console.log((d.href||"")+a)}return r},""),n=(this.settings.extraCss||"").split(",").filter(r=>r.trim().length>0).map(r=>`<link type="text/css" rel="stylesheet" href='${r.trim()}'>`).join(""),i=this.getNoPrintMediaStyle();return`<head>
							<title>${this.settings.popTitle}</title>
							${e}${t}
							<style type="text/css">${s}${i}</style>
							${n}
						</head>`}getPrintAreaDom(){const e=this.settings.el,t=typeof e=="string";if(e instanceof HTMLElement)return[e];if(!t)throw new Error("el type is not string or HTMLElement, but "+typeof e);let s=Array.from(document.querySelectorAll(e));if(!(s!=null&&s.length))throw new Error(`Can't find element with selector: ${e}`);return s}getBody(){const e=this.getPrintAreaDom(),t=document.createElement("div");return e.forEach(s=>{const n=s.cloneNode(!0);this.canvasToImgHandler(s,n),this.formDataHandler(s,n),t.appendChild(n)}),`<body>${t.innerHTML}</body>`}canvasToImgHandler(e,t){const s=e.querySelectorAll("canvas");t.querySelectorAll("canvas").forEach((i,r)=>{const d=s[r],a=i.parentNode,u=d.toDataURL("image/png"),p=new Image;p.className="canvasImg",p.style.display="block",p.src=u,a==null||a.appendChild(p),i.remove()})}formDataHandler(e,t){const s=t.querySelectorAll("input,select,textarea");let n=-1;s.forEach(i=>{var a;const r=i.value;switch((a=i.getAttribute("type"))!=null?a:i.tagName.toLowerCase()){case"select":n++;const u=e.querySelectorAll("select")[n];if(u){const p=u.selectedIndex;i.options[p].setAttribute("selected","selected")}break;case"textarea":i.innerHTML=r,i.setAttribute("html",r);break;case"radio":case"checkbox":i.checked&&i.setAttribute("checked","checked");break;default:i.value=r,i.setAttribute("value",r);break}})}getPrintWindow(e){var n;const t=this.createIframe(e),s=t.contentDocument||((n=t.contentWindow)==null?void 0:n.document)||t.document;if(!s)throw new Error("Cannot find document.");return{f:t,win:t.contentWindow||t,doc:s}}previewBoxShow(){var t;const e=document.getElementById("vue-pirnt-next-previewBox");e&&((t=document.querySelector("html"))==null||t.setAttribute("style","overflow: hidden"),e.style.display="block")}previewBoxHide(){var t,s;const e=document.getElementById("vue-pirnt-next-previewBox");e&&((t=document.querySelector("html"))==null||t.setAttribute("style","overflow: visible;"),(s=e.querySelector("iframe"))==null||s.remove(),e.style.display="none")}previewBox(){var s;let e=document.getElementById("vue-pirnt-next-previewBox");if(e)return(s=e.querySelector("iframe"))==null||s.remove(),{close:e.querySelector(".previewClose"),previewBody:e.querySelector(".previewBody")};e=document.createElement("div"),e.setAttribute("id","vue-pirnt-next-previewBox"),e.setAttribute("style","position: fixed; top: 0px; left: 0px; width: 100%; height: 100%; background: white; display: none; z-index: "+this.settings.zIndex);const t=document.createElement("div");return t.setAttribute("class","previewHeader"),t.setAttribute("style","padding: 5px 20px;"),t.innerHTML=this.settings.previewTitle||"",this.close=this.createCloseButton(),t.appendChild(this.close),e.appendChild(t),this.previewBody=this.createPreviewBody(),e.appendChild(this.previewBody),document.body.appendChild(e),{close:this.close,previewBody:this.previewBody}}createIframe(e){const t=document.createElement("iframe");if(t.id=this.iframeId,t.src=e||new Date().getTime().toString(),t.style.display="none",!this.settings.preview)document.body.appendChild(t);else{t.setAttribute("style","border: 0px; flex: 1;");const{close:s,previewBody:n}=this.previewBox();n&&n.appendChild(t),this.addEvent(s,"click",this.previewBoxHide.bind(this))}return t}createCloseButton(){const e=document.createElement("div");e.setAttribute("class","previewClose"),e.setAttribute("style","position: absolute; top: 5px; right: 20px; width: 25px; height: 20px; cursor: pointer;");const t=document.createElement("div"),s=document.createElement("div"),n="position: absolute; width: 3px; height: 100%; background: #040404; top: 0px; left: 50%;";return t.setAttribute("class","closeBefore"),t.setAttribute("style",`${n} transform: rotate(45deg);`),s.setAttribute("class","closeAfter"),s.setAttribute("style",`${n} transform: rotate(-45deg);`),e.appendChild(t),e.appendChild(s),e}createPreviewBody(){const e=document.createElement("div");e.className="previewBody",e.style.cssText="display: flex; flex-direction: column; height: 100%;";const t=document.createElement("div");return t.className="previewBodyUtil",t.style.cssText="height: 32px; background: #474747; position: relative;",this.previewBodyUtilPrintBtn=document.createElement("div"),this.previewBodyUtilPrintBtn.className="previewBodyUtilPrintBtn",this.previewBodyUtilPrintBtn.style.cssText="position: absolute; padding: 2px 10px; margin-top: 3px; left: 24px; font-size: 14px; color: white; cursor: pointer; background: rgba(0,0,0,.12); border: 1px solid rgba(0,0,0,.35); box-shadow: inset 0 1px 0 hsla(0,0%,100%,.05), inset 0 0 1px hsla(0,0%,100%,.15);",this.previewBodyUtilPrintBtn.innerHTML=this.settings.previewPrintBtnLabel||"",t.appendChild(this.previewBodyUtilPrintBtn),e.appendChild(t),e}}const c=(h,e,t)=>{h.addEventListener?h.addEventListener(e,t,!1):h.attachEvent?h.attachEvent("on"+e,t):h["on"+e]=t},f={directiveName:"print",mounted(h,e){let t="",s={};c(h,"click",()=>{if(typeof e.value=="string")t=e.value;else if(typeof e.value=="object"&&e.value.el)t=e.value.el,s=e.value;else{window.print();return}new o(m(y({},s),{el:t,vue:e.instance}))})},bind(h,e,t){e.instance=t.context,f.mounted(h,e)}},b={install(h){h.directive(f.directiveName,f)}};l.VuePrintNext=o,l.printPlugin=b,l.vPrint=f,Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})});
